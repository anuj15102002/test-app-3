generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
}

model PopupConfig {
  id                String   @id @default(cuid())
  shop              String
  name              String   @default("Untitled Popup")
  type              String
  title             String
  description       String
  placeholder       String?
  buttonText        String
  discountCode      String?
  backgroundColor   String
  textColor         String
  buttonColor       String?
  borderRadius      Int?
  showCloseButton   Boolean  @default(true)
  displayDelay      Int      @default(3000)
  segments          String?  @db.Text
  backgroundType    String?
  isActive          Boolean  @default(true)
  frequency         String   @default("once")
  exitIntent        Boolean  @default(false)
  exitIntentDelay   Int      @default(1000)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  askMeLaterText    String?
  bannerImage       String?  @db.Text
  showAskMeLater    Boolean  @default(true)
  socialIcons       String?  @db.Text
  timerDays         Int?     @default(0)
  timerHours        Int?     @default(0)
  timerMinutes      Int?     @default(5)
  timerSeconds      Int?     @default(0)
  timerIcon         String?  @default("⏰")
  onExpiration      String?  @default("show_expired")
  expiredTitle      String?  @default("OFFER EXPIRED")
  expiredMessage    String?  @db.Text
  expiredIcon       String?  @default("⏰")
  expiredButtonText String?  @default("CONTINUE SHOPPING")
  successTitle      String?  @default("SUCCESS!")
  successMessage    String?  @db.Text
  disclaimer        String?  @db.Text

  @@index([shop])
  @@index([shop, isActive])
}

model DiscountCode {
  id             String   @id @default(cuid())
  shop           String
  email          String
  code           String   @unique
  discountType   String
  discountValue  String
  priceRuleId    String?
  discountCodeId String?
  isActive       Boolean  @default(true)
  usageCount     Int      @default(0)
  usageLimit     Int      @default(1)
  startsAt       DateTime @default(now())
  endsAt         DateTime
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([shop])
  @@index([email])
  @@index([code])
}

model PopupAnalytics {
  id           String   @id @default(cuid())
  shop         String
  eventType    String
  email        String?
  discountCode String?
  prizeLabel   String?
  userAgent    String?
  ipAddress    String?
  sessionId    String?
  timestamp    DateTime @default(now())
  metadata     String?  @db.Text

  @@index([shop])
  @@index([eventType])
  @@index([timestamp])
  @@index([shop, eventType])
}
